from flask import Flask, request, render_template_string
import speech_recognition as sr
import os

app = Flask(__name__)

# HTML form and display
HTML_FORM = '''
<!DOCTYPE html>
<html>
<head>
    <title>Voice to Text</title>
</head>
<body>
    <h2>Upload .wav File</h2>
    <form method="POST" enctype="multipart/form-data">
        <input type="file" name="audio" accept=".wav" required>
        <button type="submit">Convert</button>
    </form>

    {% if result %}
        <h3>Transcribed Text:</h3>
        <p>{{ result }}</p>
    {% endif %}

    {% if error %}
        <h3 style="color:red;">Error:</h3>
        <p>{{ error }}</p>
    {% endif %}
</body>
</html>
'''

@app.route('/', methods=['GET', 'POST'])
def index():
    result = None
    error = None

    if request.method == 'POST':
        if 'audio' not in request.files:
            error = "No audio file uploaded"
        else:
            file = request.files['audio']
            file_path = "temp.wav"
            file.save(file_path)

            recognizer = sr.Recognizer()
            with sr.AudioFile(file_path) as source:
                audio_data = recognizer.record(source)
                try:
                    result = recognizer.recognize_google(audio_data)
                except sr.UnknownValueError:
                    error = "Could not understand the audio"
                except sr.RequestError:
                    error = "Speech recognition service error"
                finally:
                    os.remove(file_path)

    return render_template_string(HTML_FORM, result=result, error=error)

if __name__ == '__main__':
    app.run(debug=True)
